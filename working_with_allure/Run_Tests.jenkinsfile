node('master') {
    def hosts = HOSTS.split(',') as List
    stage('run tests') {
        for(each in hosts) {
            node(each){
                try{
                    bat script:'pytest --alluredir=Z:\\working_with_allure\\Run_Tests\\allure-results D:\\jenkins\\automation\\workspace\\allure_testing\\working_with_allure\\test_dummy.py'
                }
                catch(err) {
                    println err
                    currentBuild.result = 'UNSTABLE'
                }
            }
        }
    }

    stage('copy allure results from share to workspace') {
        sh 'cp -a /working_with_allure/Run_Tests/allure-results/ /var/jenkins_home/workspace/Run_Tests/'
    }
    stage('reports') {
        script {
                allure([
                        includeProperties: false,
                        jdk: '',
                        properties: [],
                        reportBuildPolicy: 'ALWAYS',
                        results: [[path: '/var/jenkins_home/workspace/Run_Tests/allure-results']]
                ])
                archiveArtifacts artifacts: '/var/jenkins_home/workspace/Run_Tests/allure-report/*', fingerprint: true
        }
    }
}