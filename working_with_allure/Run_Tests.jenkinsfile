node('master') {
    def hosts = HOSTS.split(',') as List
    stage('run tests') {
        for(each in hosts) {
            node(each){
                try{
                    bat script:'python -m pytest D:\\jenkins\\automation\\workspace\\allure_testing\\working_with_allure\\test_dummy.py --alluredir Z:\\working_with_allure\\allure-results'
                }
                catch(err) {
                    println err
                    currentBuild.result = 'UNSTABLE'
                }
            }
        }
    }

    stage('reports') {
        script {
                allure([
                        includeProperties: false,
                        jdk: '',
                        properties: [],
                        reportBuildPolicy: 'ALWAYS',
                        results: [[path: '\\allure-results']]
                ])
        }
    }
}